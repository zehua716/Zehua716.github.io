---
title: "卡尔曼滤波"
# author: "Zehua"
date: "2024-05-05T16:25:17+01:00"
lastmod: "2024-11-24T17:12:35+08:00"
lang: "zh"
draft: true
summary: "实验内容"
description: "图像恢复中去卷积问题"
tags: ["信号处理","图像处理"]
# categories: "posts"
#cover:
    #image: "img/signal.png"
# comments: true
# hideMeta: false
searchHidden: true
# ShowBreadCrumbs: true
# ShowReadingTime: false

---

## **随机变量与噪声的定义及生成**

设 $x$ 是一个包含 1000 个点的随机变量，均值为 2，$e$ 是一个包含 1000 个点的高斯白噪声。定义：
$$
y = 2x^2 + e
$$
绘制 $y$ 关于 $x$ 的图像，以及 $\tilde{y}$ 关于 $\tilde{x}$ 的图像。计算 $x$ 和 $y$ 的均值及协方差矩阵。

解
$$
\tilde{y} = y - \bar{y}
$$
均值：
$$
\mathbb{E}(x) = 2, \quad \mathbb{E}(y) = 0
$$
协方差矩阵公式：
$$
\Gamma_{xx} = \mathbb{E}\left[(x - \bar{x})(x - \bar{x})^\top\right]
$$

$$
\Gamma_{yy} = \mathbb{E}\left[(y - \bar{y})(y - \bar{y})^\top\right]
$$

$x^2$ 的均值计算：
$$
\mathbb{E}(x^2) = \text{Var}(x) + \mathbb{E}^2(x)
= 1 + 4 = 5
$$
$y$ 的均值：
$$
\mathbb{E}(y) = 10
$$
$x$ 的方差计算：
$$
\Gamma_x = \mathbb{E}[(x - 2)^2] = \mathbb{E}[x^2] - 4\mathbb{E}(x) + 4 = 5 - 4 = 1
$$

```matlab
clear all;clc;
n = 1000; % 定义点的数量为1000

e = randn(1,n);   % 生成高斯白噪声（1000个点）

x = 2 + randn(1,n);  % 生成以2为中心的随机变量x
y = 2*x.^2 + e;  % 计算目标变量y，非线性关系 2x^2 + 噪声

x_chap = x - mean(x); % 将x去中心化，使其均值为0
y_chap = y - mean(y); % 将y去中心化，使其均值为0

figure;
plot(x_chap,y_chap,'*')  % 绘制去中心化处理后的数据对 (x_chap, y_chap) 的分布图
xlabel('$\hat{x}$ (centered x)', 'Interpreter', 'latex');
ylabel('$\hat{y}$ (centered y)', 'Interpreter', 'latex');
title('Scatter plot of $\hat{y}$ versus $\hat{x}$', 'Interpreter', 'latex');


mean_x=mean(x); % 计算x的均值
mean_y=mean(y); % 计算y的均值
mean_x_chap  =mean(x_chap.^2); % 计算x去中心化后的平方均值（方差）
mean_y_chap  =mean(y_chap.^2); % 计算y去中心化后的平方均值（方差）
mean_xy_chap =mean(x_chap.*y_chap);   % 计算x去中心化和y去中心化的协方差

% 打印各统计值
fprintf('Mean of x: %f\n', mean_x); % 打印x的均值
fprintf('Mean of y: %f\n', mean_y); % 打印y的均值
fprintf('Mean of x_chap^2: %f\n', mean_x_chap); % 打印x去中心化平方的均值
fprintf('Mean of y_chap^2: %f\n', mean_y_chap); % 打印y去中心化平方的均值
fprintf('Mean of x_chap * y_chap: %f\n', mean_xy_chap); % 打印x去中心化和y去中心化的协方差
```

![exo_1_1](/Users/zehua/Documents/GitHub/Zehua716.github.io/static/img/kalman/exo_1_1.png)

显示**抛物线加噪声** 的特征分布，这是由于原始的二次关系 $ y = 2x^2 + e $。去中心化之后，数据的分布没有改变其非线性特征，这说明数据的中心平移操作并不影响变量之间的关系。



## **协方差矩阵** S1 **的特征值分解**

计算随机矩阵 A 的协方差矩阵 $S1 = A \times A' $ ；

使用特征值分解对协方差矩阵进行处理，并重新构造矩阵 S2 ；

通过平方根矩阵的概念，进一步构造矩阵 S3 。



```matlab
 %特征值的分解和特征向量的计算
clear all;clc;
A = rand(3,3);
S1 = A * A';
[R,D] = eig(S1);%对矩阵 S1 进行特征值分解，其中 R 是包含 S1 的特征向量的矩阵，而 D 是对角矩阵，其对角线上的元素是对应的特征值。
S2 = R * D * R';%使用特征向量和特征值重构矩阵 S1，确保 S2 与 S1 相同.....正交矩阵（R），逆矩阵等于转置矩阵。
A2 = sqrtm(S2);%这行代码计算矩阵 S2 的平方根，即找到一个矩阵 A2，使得 A2 * A2' = S2
S3 = A2 * A2';%验证 A2 是否确实是 S2 的平方根
```

A是随机生成的，不具有数学特性，A2是计算得到的平方根，因为S1 和S2都是对称、正定矩阵(由矩阵乘其转置生成)，所以其实A2也是一个对称矩阵

 对 S1 的分解得到 $\Gamma = R \cdot D \cdot R^{-1}$ ，其中 D 是对角矩阵，包含 S1 的特征值，R 是正交矩阵，包含矩阵 S1 的特征向量

 S1, S2, S3 是相同的矩阵（由于 S2, S3 是由 S1 的特征值和分解重构得到的）。

$A \neq A2$ ：因为 A 是随机的，而 A2 是对称的。

得到结果如下:
$$
A = \begin{bmatrix}
0.7502 & 0.3628 & 0.3314 \\\\
0.0787 & 0.7970 & 0.9500 \\\\
0.8680 & 0.7864 & 0.8285
\end{bmatrix} \quad \quad \quad \quad A2 = \begin{bmatrix}
0.5627 & 0.1330 & 0.6855 \\\\
0.1330 & 1.0476 & 0.6547 \\\\
0.6855 & 0.6547 & 1.0768
\end{bmatrix}
$$

$$
S1 = \begin{bmatrix}
0.8042 & 0.6630 & 1.2110 \\\\
0.6630 & 1.5439 & 1.4822 \\\\
1.2110 & 1.4822 & 2.0581
\end{bmatrix} \quad S2 = \begin{bmatrix}
0.8042 & 0.6630 & 1.2110 \\\\
0.6630 & 1.5439 & 1.4822 \\\\
1.2110 & 1.4822 & 2.0581
\end{bmatrix}\quad S3 = \begin{bmatrix}
0.8042 & 0.6630 & 1.2110 \\\\
0.6630 & 1.5439 & 1.4822 \\\\
1.2110 & 1.4822 & 2.0581
\end{bmatrix}
$$



## 练习3

**从标准正态分布生成二维数据点，并将这些数据通过一个线性变换和偏移得到新的分布数据点，然后可视化其分布特性**

```matlab
% 清除工作空间和命令窗口
clear; clc;
set(0,'defaultfigurecolor','w')
% 设置参数
N = 1000; % 样本数量
Gamma_y = [3 2; 2 3]; % 协方差矩阵
ybar = [2; 3]; % 均值向量

% 生成随机二维标准正态分布数据
X = randn(2, N);

% 计算变换矩阵和偏移向量
A = sqrtm(Gamma_y); % 矩阵平方根
b = ybar; % 偏移向量

% 线性变换生成目标分布数据
Y = A * X + b;

% 绘制图像
figure;

% 子图1：标准正态分布数据散点图
subplot(1, 2, 1);
scatter(X(1, :), X(2, :), '*');
title('Standard Normal Distribution');
xlabel('X_1');
ylabel('X_2');
axis equal;

% 子图2：变换后的数据散点图
subplot(1, 2, 2);
scatter(Y(1, :), Y(2, :), '*');
title('Transformed Distribution');
xlabel('Y_1');
ylabel('Y_2');
axis equal;

```

![exo_3_1](/Users/zehua/Documents/GitHub/Zehua716.github.io/static/img/kalman/exo_3_1.png)



四

绘制包含高斯随机向量$y$的置信椭圆$\varepsilon_y$，它由概率$\eta = 0.9$的随机向量$x$生成。
$$
y = \bar{y} + a \sqrt{G_y} \cdot w
$$
其中 $w$ 被定义为
$$
w = \text{randn}(2, 100)
$$

$$
y_1 = \bar{y} + \Gamma_y^{\frac{1}{2}} \cdot x
$$

其中 $\Gamma_y$ 表示协方差矩阵的平方根，x 为随机向量的单位方向

**椭圆**
$$
y_1 = \bar{y} + \Gamma_y^{\frac{1}{2}} \cdot a \cdot s
$$
其中，$s$ 是由 $\cos(\theta)$ 和 $\sin(\theta)$ 构成的单位圆参数化形式，$\theta$ 为圆周角变量
$$
a = \sqrt{-2 \ln(1 - \eta)}
$$
![exo_4_1](/Users/zehua/Documents/GitHub/Zehua716.github.io/static/img/kalman/exo_4_1.png)





### 练习5：置信椭圆（预测）

1. 生成一个由 $N = 1000$ 个点组成的点云，表示一个以 $\mathbb{R}^2$ 中心为零的高斯随机向量，其协方差矩阵为单位矩阵。从中推导出向量 $\mathbf{x}$ 的点云，使得：
   $$
   \bar{\mathbf{x}} = \begin{bmatrix} 1 \\ 2 \end{bmatrix}, \quad \Gamma_{\mathbf{x}} = \begin{bmatrix} 4 & 3 \\ 3 & 3 \end{bmatrix}.
   $$

   将点云存储在一个具有 $2$ 行和 $N$ 列的矩阵中。

2. 绘制对应于置信概率 $\eta \in \{0.9, 0.99, 0.999\}$ 的置信椭圆。

   ```matlab
   % 任务 1：清除工作区并设置初始参数
   clear; close all; clc;
   
   % 参数定义
   N = 1000; % 样本数量
   b = randn(2, N); % 二维标准正态随机变量
   
   Gamma = [4 3; 3 3]; % 协方差矩阵
   xbar = [1; 2]; % 均值向量
   
   A = sqrtm(Gamma); % 协方差矩阵平方根
   x = xbar + A * b; % 转换为具有均值 xbar 和协方差 Gamma 的分布
   
   % 绘制点云和置信椭圆
   figure;
   plot(x(1, :), x(2, :), '+'); % 点云
   hold on;
   draw_ellipse(xbar, Gamma, 0.9, 'g'); % 置信水平 0.9 的椭圆（绿色）
   draw_ellipse(xbar, Gamma, 0.99, 'b'); % 置信水平 0.99 的椭圆（蓝色）
   draw_ellipse(xbar, Gamma, 0.999, 'r'); % 置信水平 0.999 的椭圆（红色）
   grid on;
   title('Point Cloud and Confidence Ellipses');
   xlabel('x_1');
   ylabel('x_2');
   axis equal;
   ```

   ![exo_5_1](/Users/zehua/Documents/GitHub/Zehua716.github.io/static/img/kalman/exo_5_1.png)

3. 从 $\mathbf{x}$ 的点云中重新估计 $\bar{\mathbf{x}}$ 和 $\Gamma_{\mathbf{x}}$。

   ```matlab
   %% 任务 3：从点云中估算均值和协方差矩阵
   % 计算估计的均值
   est_xbar = mean(x, 2);
   
   % 计算估计的协方差矩阵
   est_Gx = cov(x.');
   
   % 显示估计结果
   disp('Estimated Mean (x̄):');
   disp(est_xbar);
   disp('Estimated Covariance Matrix (Γ_x):');
   disp(est_Gx);
   ```

   得到结果如下
   $$
   \bar{x} = \begin{bmatrix} 
   1.0198 \\ 
   1.9623 
   \end{bmatrix}
   $$

   $$
   \Gamma_x = \begin{bmatrix} 4.5078 & 3.4705 \\ 3.4705 & 3.4477 \end{bmatrix}
   $$

4. 此分布表示我们对系统初始条件（例如一个机器人）的认识，该系统由以下形式的状态方程描述：
   $$
   \dot{\mathbf{x}} = \begin{bmatrix} 0 & 1 \\ -1 & 0 \end{bmatrix} \mathbf{x} + \begin{bmatrix} 2 \\ 3 \end{bmatrix} u,
   $$
   其中输入 $u(t) = \sin(t)$ 是已知的。编写一个程序来演示随时间的点云演变。采样周期取为 $\delta = 0.01 \ \mathrm{s}$。

5. 仅通过使用置信椭圆的计算来表示此演变。

   ```matlab
   %% 任务 4：动态点云及椭圆随时间变化
   % 清除所有变量并关闭所有图形窗口
   clear; close all;
   
   % 参数定义
   N = 1000; % 样本数量
   b = randn(2, N); % 二维标准正态随机变量
   
   Gamma = [4 3; 3 3]; % 协方差矩阵
   xbar = [1; 2]; % 均值向量
   
   A = sqrtm(Gamma); % 协方差矩阵平方根
   x = xbar + A * b; % 初始点云
   
   % 动态系统定义
   A_dyn = [0 1; -1 0]; % 动态系统矩阵
   B_dyn = [2; 3]; % 控制输入向量
   dt = 0.01; % 时间步长
   tf = 5; % 模拟总时长
   time = 0:dt:tf; % 时间向量
   
   % 初始点云
   X = randn(2, N);
   
   % 动态仿真
   figure;
   for t = time
       % 动态系统更新
       Ag = eye(2) + A_dyn * dt; % 离散化系统矩阵
       ug = dt * B_dyn * sin(t); % 控制输入
   
       X = Ag * X + ug; % 更新点云位置
   
       % 从点云估算均值和协方差矩阵
       est_xbar = mean(X, 2); % 估计均值
       est_Gx = cov(X.'); % 估计协方差矩阵
   
       % 绘制点云及置信椭圆
       clf();
       plot(X(1, :), X(2, :), '+'); % 动态点云
       hold on;
       draw_ellipse(est_xbar, est_Gx, 0.999, 'g'); % 绘制置信椭圆（置信水平 0.999）
       title(['Dynamic Point Cloud and Confidence Ellipse at t = ', num2str(t)]);
       xlabel('x_1');
       ylabel('x_2');
       axis equal;
       grid on;
       drawnow;
   end
   ```

   ![Dynamic Point Cloud Animation](/img/kalman/dynamic_point_cloud.gif)





### 练习7：协方差矩阵的传播

我们考虑三个随机向量 $\mathbf{a}$、$\mathbf{b}$ 和 $\mathbf{c}$，它们以零为中心，协方差矩阵等于单位矩阵。这三个向量相互独立。定义两个随机向量如下：
$$
\mathbf{x} = \mathbf{A} \mathbf{a} - \mathbf{b}, \quad \mathbf{y} = \mathbf{C} \mathbf{x} + \mathbf{c},
$$
其中 $\mathbf{A}$ 和 $\mathbf{C}$ 是已知矩阵。

1. 给出这些随机向量的数学期望 $\bar{\mathbf{x}}$ 和 $\bar{\mathbf{y}}$ 及其协方差矩阵 $\Gamma_{\mathbf{x}}$ 和 $\Gamma_{\mathbf{y}}$ 的表达式，作为 $\mathbf{A}$ 和 $\mathbf{C}$ 的函数。

   $$ \bar{\mathbf{x}} = \mathbf{A} \bar{\mathbf{a}} - \bar{\mathbf{b}} = 0 $$

   $$ \bar{\mathbf{y}} = \mathbf{C} \bar{\mathbf{x}} + \bar{\mathbf{c}} = 0 $$

    $$ \Gamma_{\mathbf{x}} = \mathbf{A} \Gamma_{\mathbf{a}} \mathbf{A}^\top + \mathbf{I} $$

    $$ \Gamma_{\mathbf{y}} = \mathbf{C} \Gamma_{\mathbf{x}} \mathbf{C}^\top + \mathbf{I} $$

   
   $$
   \begin{aligned}
   \Gamma_{\mathbf{x}} &=\mathbb{E}\left[(\mathbf{x} - \bar{\mathbf{x}})(\mathbf{x} - \bar{\mathbf{x}})^\top\right]= \mathbb{E}[\mathbf{x} \mathbf{x}^\top] \\
   &= \mathbb{E}[(\mathbf{A} \mathbf{a} - \mathbf{b})(\mathbf{A} \mathbf{a} - \mathbf{b})^\top] \\
   &= \mathbb{E}[(\mathbf{A} \mathbf{a} - \mathbf{b})(\mathbf{a}^\top \mathbf{A}^\top - \mathbf{b}^\top)] \\
   &= \mathbb{E}[\mathbf{A} \mathbf{a} \mathbf{a}^\top \mathbf{A}^\top - \mathbf{A} \mathbf{a} \mathbf{b}^\top - \mathbf{b} \mathbf{a}^\top \mathbf{A}^\top + \mathbf{b} \mathbf{b}^\top] \\
   &= \mathbf{A} \Gamma_{\mathbf{a}} \mathbf{A}^\top - \mathbf{A} \mathbb{E}[\mathbf{a}] \mathbb{E}[\mathbf{b}]^\top - \mathbb{E}[\mathbf{b}] \mathbb{E}[\mathbf{a}]^\top \mathbf{A}^\top + \Gamma_{\mathbf{b}}.
   \end{aligned}
   $$
   因为:
   $$
   \mathbb{E}[\mathbf{a}] = 0
   $$
   所以:
   $$
   - \mathbb{E}[\mathbf{b}] \cdot \mathbb{E}[\mathbf{a}]^\top \cdot \mathbf{A}^\top = 0
   $$
   并且:
   $$
   \Gamma_{\mathbf{b}} =0
   $$
   同理计算
   $$
   \begin{aligned}
   \Gamma_{\mathbf{y}} &= \mathbb{E}[(\mathbf{y} - \bar{\mathbf{y}})(\mathbf{y} - \bar{\mathbf{y}})^\top] \\
   &= \mathbb{E}[(\mathbf{C} \mathbf{x} + \mathbf{c})(\mathbf{C} \mathbf{x} + \mathbf{c})^\top] \\
   &= \mathbb{E}[\mathbf{C} \mathbf{x} \mathbf{x}^\top \mathbf{C}^\top + \mathbf{C} \mathbf{x} \mathbf{c}^\top + \mathbf{c} \mathbf{x}^\top \mathbf{C}^\top + \mathbf{c} \mathbf{c}^\top] \\
   &= \mathbf{C} \Gamma_{\mathbf{x}} \mathbf{C}^\top + \mathbf{C} \mathbb{E}[(\mathbf{A} \mathbf{a} - \mathbf{b}) \mathbf{c}^\top] + \Gamma_{\mathbf{c}} \\
   &= \mathbf{C} \Gamma_{\mathbf{x}} \mathbf{C}^\top + \mathbf{C} (\mathbf{A} \mathbb{E}[\mathbf{a}] \mathbb{E}[\mathbf{c}]^\top - \mathbb{E}[\mathbf{b}] \mathbb{E}[\mathbf{c}]^\top) + \Gamma_{\mathbf{c}}\\
   &= \mathbf{C} \Gamma_{\mathbf{x}} \mathbf{C}^\top + \mathbf{I}\\
   &=  \mathbf{C} \mathbf{A} \Gamma_{\mathbf{a}} \mathbf{A}^\top \mathbf{C}^\top + \mathbf{C} \mathbf{C}^\top + \mathbf{I}
   
   
   \end{aligned}
   $$
   
2. 构造向量 $\mathbf{v} = (\mathbf{x}, \mathbf{y})$。计算向量 $\mathbf{v}$ 的数学期望 $\bar{\mathbf{v}}$ 和协方差矩阵 $\Gamma_{\mathbf{v}}$。
   $$
   \mathbf{v} = 
   \begin{bmatrix}
   \mathbf{x} \\
   \mathbf{y}
   \end{bmatrix}
   \implies 
   \bar{\mathbf{v}} = 
   \begin{bmatrix}
   \mathbb{E}[\mathbf{x}] \\
   \mathbb{E}[\mathbf{y}]
   \end{bmatrix} 
   = 
   \begin{bmatrix}
   0 \\
   0
   \end{bmatrix}
   $$

   $$
   \Gamma_{\mathbf{v}} = \mathbb{E}[\mathbf{v} \mathbf{v}^\top] = 
   \mathbb{E}
   \begin{bmatrix}
   \mathbf{x} \\
   \mathbf{y}
   \end{bmatrix}
   \begin{bmatrix}
   \mathbf{x}^\top & \mathbf{y}^\top
   \end{bmatrix}
   = 
   \begin{bmatrix}
   \mathbb{E}[\mathbf{x} \mathbf{x}^\top] & \mathbb{E}[\mathbf{x} \mathbf{y}^\top] \\
   \mathbb{E}[\mathbf{y} \mathbf{x}^\top] & \mathbb{E}[\mathbf{y} \mathbf{y}^\top]
   \end{bmatrix}
   $$

   $$
   \Gamma_{\mathbf{v}}= \begin{bmatrix} \Gamma_{\mathbf{x}} & \Gamma_{\mathbf{x}} \mathbf{C}^\top \\ \mathbf{C} \Gamma_{\mathbf{x}} & \Gamma_{\mathbf{y}} \end{bmatrix}
   $$

   $$
   \mathbb{E}[\mathbf{x} \mathbf{y}^\top] = \mathbb{E}[\mathbf{x} (\mathbf{x}^\top \mathbf{C}^\top + \mathbf{c}^\top)]
   = \Gamma_{\mathbf{x}} \mathbf{C}^\top + \mathbb{E}[\mathbf{x} \mathbf{c}^\top]
   $$

   $$
   \mathbb{E}[\mathbf{y} \mathbf{x}^\top] = \mathbb{E}[(\mathbf{C} \mathbf{x} + \mathbf{c}) \mathbf{x}^\top] 
   = \mathbb{E}[\mathbf{C} \mathbf{x} \mathbf{x}^\top + \mathbf{c} \mathbf{x}^\top]
   = \mathbf{C} \Gamma_{\mathbf{x}} + 0
   $$

   

3. 从上一步推导随机向量 $\mathbf{z} = \mathbf{y} - \mathbf{x}$ 的协方差矩阵。假设 $\mathbf{x}$ 和 $\mathbf{y}$ 的维度相同。
   $$
   \mathbf{z} = \mathbf{y} - \mathbf{x}
   $$

   $$
   \Gamma_{\mathbf{z}} = \mathbb{E}[(\mathbf{z} - \bar{\mathbf{z}})(\mathbf{z} - \bar{\mathbf{z}})^\top]
   $$

   $$
   \bar{\mathbf{z}} = 0 \implies \Gamma_{\mathbf{z}} = \mathbb{E}[(\mathbf{y} - \mathbf{x})(\mathbf{y} - \mathbf{x})^\top]
   $$

   $$
   \begin{aligned}
   \Gamma_{\mathbf{z}} &= \mathbb{E}[(\mathbf{y} - \mathbf{x})(\mathbf{y} - \mathbf{x})^\top] \\
   &= \mathbb{E}[\mathbf{y} \mathbf{y}^\top - \mathbf{y} \mathbf{x}^\top - \mathbf{x} \mathbf{y}^\top + \mathbf{x} \mathbf{x}^\top] \\
   &= \Gamma_{\mathbf{y}} - \mathbb{E}[\mathbf{y} \mathbf{x}^\top] - \mathbb{E}[\mathbf{x} \mathbf{y}^\top] + \Gamma_{\mathbf{x}}.
   \end{aligned}
   $$

   其中:
   $$
   \mathbb{E}[\mathbf{y} \mathbf{x}^\top] = \mathbf{C} \Gamma_{\mathbf{x}}
   $$

   $$
   \mathbb{E}[\mathbf{x} \mathbf{y}^\top] = 
   \Gamma_{\mathbf{xy}} = \Gamma_{\mathbf{x}} \mathbf{C}^\top
   $$

   

4. 对 $\mathbf{y}$ 进行一次测量，因此此随机向量变为确定性向量，并完全已知。使用线性、非偏和正交估计器，给出 $\mathbf{x}$ 的估计值 $\hat{\mathbf{x}}$。

$$
\hat{\mathbf{x}} = \bar{\mathbf{x}} + \mathbf{K} (\mathbf{y} - \bar{\mathbf{y}})
$$

$$
\bar{\mathbf{x}} = 0, \quad \bar{\mathbf{y}} = 0 \implies \hat{\mathbf{x}} = \mathbf{K} \mathbf{y}
$$

$$
\mathbf{K} = \Gamma_{\mathbf{xy}} \Gamma_{\mathbf{y}}^{-1}
$$

​	代入得：
$$
\hat{\mathbf{x}} = \Gamma_{\mathbf{x}} \mathbf{C}^\top (\mathbf{C} \Gamma_{\mathbf{x}} \mathbf{C}^\top + \mathbf{I})^{-1} \mathbf{y}
$$


### 练习8：摆线

一个点质量（放置在一个轮子上）沿着如下形式的摆线运动：
$$
\begin{cases}
x(t) = p_1 t - p_2 \sin t, \\
y(t) = p_1 - p_2 \cos t,
\end{cases}
$$
其中，$x$ 对应于质量的横坐标，$y$ 对应于质量的高度。测量了不同时间点 $t$ 下的 $y$ 值：
$$
\begin{array}{|c|c|c|c|c|}
\hline
t \ (\mathrm{s}) & 1 & 2 & 3 & 7 \\
\hline
y \ (\mathrm{m}) & 0.38 & 3.25 & 4.97 & -0.26 \\
\hline
\end{array}
$$

1. 测量误差具有 $10\ \mathrm{cm}$ 的标准差。使用非偏正交滤波器，计算 $p_1$ 和 $p_2$ 的估计值。

   
   $$
   \mathbf{y} = \mathbf{C} \mathbf{p} + \boldsymbol{\beta}, \quad \mathbf{p} = 
   \begin{bmatrix}
   p_1 \\
   p_2
   \end{bmatrix}
   $$

   $$
   \hat{\mathbf{p}} = \bar{\mathbf{p}} + \mathbf{K} (\mathbf{y} - \bar{\mathbf{y}})
   $$

   $$
   \bar{\mathbf{p}} = 
   \begin{bmatrix}
   0 \\
   0
   \end{bmatrix}, \quad \Gamma_{\mathbf{p}} = \mathbf{I} \cdot 10^4
   $$

   $$
   \Gamma_{\mathbf{y}} = \mathbf{C} \Gamma_{\mathbf{p}} \mathbf{C}^\top + \Gamma_{\boldsymbol{\beta}}
   $$

   $$
   \mathbf{K} = \Gamma_{\mathbf{p}} \mathbf{C}^\top \Gamma_{\mathbf{y}}^{-1}
   $$

   $$
   \Gamma_{\boldsymbol{\varepsilon}} = \Gamma_{\mathbf{p}} - \mathbf{K} \mathbf{C} \Gamma_{\mathbf{p}}
   $$

   

   ```matlab
   % 清理工作区并初始化
   close all; clc;
   
   % 已知测量数据
   t = [1; 2; 3; 7]; % 时间点 (s)
   y = [0.38; 3.25; 4.97; -0.26]; % 高度数据 (m)
   
   % 构造观测矩阵 C
   C = [ones(size(t)), -cos(t)]; % 矩阵 [1, -cos(t)]
   
   % 参数初始化
   pbar = zeros(2, 1); % 参数估计初值
   GammaP = 1e4 * eye(2); % 参数协方差初值
   GammaB = (0.1)^2 * eye(length(t)); % 测量噪声协方差矩阵
   
   % 计算总噪声协方差矩阵
   GammaY = C * GammaP * C' + GammaB;
   
   % 卡尔曼增益计算
   K = GammaP * C' / GammaY;
   
   % 更新协方差矩阵
   GammaEpsilon = GammaP - K * C * GammaP;
   
   % 残差计算
   ytild = y - C * pbar;
   
   % 更新参数估计
   Phat = pbar + K * ytild;
   
   % 打印估计参数
   disp('估计的参数值:');
   disp(['p1 = ', num2str(Phat(1))]);
   disp(['p2 = ', num2str(Phat(2))]);
   ```

   

2. 绘制点质量的估计轨迹（$x$ 和 $y$）并同时绘制 $y$ 的轨迹，将真实数据叠加于上。

   ```matlab
   % 模拟轨迹生成
   ta = 0:0.01:12; % 模拟时间范围
   x1 = Phat(1) * ta - Phat(2) * sin(ta); % x 轨迹
   y1 = Phat(1) - Phat(2) * cos(ta); % y 轨迹
   
   % 绘图：摆线轨迹
   figure;
   subplot(2, 1, 1);
   plot(x1, y1, 'r', 'LineWidth', 1.5); hold on;
   xlabel('x (m)'); ylabel('y (m)');
   title('点质量估计轨迹');
   grid on;
   
   % 绘图：y 轨迹与真实数据比较
   subplot(2, 1, 2);
   plot(ta, y1, 'b', 'LineWidth', 1.5); hold on;
   plot(t, y, 'r+', 'MarkerSize', 8, 'LineWidth', 1.5);
   xlabel('t (s)'); ylabel('y (m)');
   legend('估计轨迹', '真实数据', 'Location', 'Best');
   title('估计轨迹与真实数据比较');
   grid on;
   ```

   ![exo_9_1](/Users/zehua/Documents/GitHub/Zehua716.github.io/static/img/kalman/exo_9_1.png)



### 练习9：解三元一次方程

线性估计器可以用于解决可转化为线性方程的问题。考虑以下系统：
$$
\begin{cases}
2x_1 + 3x_2 = 8 + \beta_1, \\
3x_1 + 2x_2 = 7 + \beta_2, \\
x_1 - x_2 = 0 + \beta_3,
\end{cases}
$$
其中，$\beta_1, \beta_2, \beta_3$ 是三个独立的随机变量，均值为 $0$，方差分别为 $1, 4, 4$。

#### 问题：

1. 使用 Kalman 滤波器调用三次，利用 Matlab 解决此系统。给出解的估计值和误差的协方差矩阵。

   ### 公式

   $$
   S = \mathbf{C} \mathbf{G}_0 \mathbf{C}^\top + \Gamma_{\boldsymbol{\beta}}
   $$
   $$
   \mathbf{K} = \mathbf{G}_0 \mathbf{C}^\top S^{-1}
   $$
   $$
   \tilde{\mathbf{y}} = \mathbf{y} - \mathbf{C} \mathbf{x}_0
   $$
   $$
   \hat{\mathbf{x}} = \mathbf{x}_0 + \mathbf{K} \tilde{\mathbf{y}}
   $$
   $$
   \hat{\mathbf{G}} = \mathbf{G}_0 - \mathbf{K} \mathbf{C} \mathbf{G}_0
   $$
   $$
   \mathbf{x}_1 = \mathbf{A} \hat{\mathbf{x}} + \mathbf{u}
   $$
   $$
   \mathbf{G}_1 = \mathbf{A} \hat{\mathbf{G}} \mathbf{A}^\top + \mathbf{G}_\alpha
   $$

   $$
   \mathbf{G}_2 = \mathbf{0}_{2 \times 2}
   $$

   $$
   \mathbf{G}_{\beta}= 
   \begin{pmatrix}
   1 & 0 & 0 \\
   0 & 4 & 0 \\
   0 & 0 & 4
   \end{pmatrix}
   $$

   $$
   \mathbf{x}_0 = 
   \begin{pmatrix}
   0 \\
   0
   \end{pmatrix}
   $$

   

2. 绘制每次调用对应的置信椭圆。

   ```matlab
   % 清理工作区并初始化
   clear all;
   clc;
   close all;
   
   % 系统参数
   Galpha = zeros(2, 2); % 过程噪声协方差
   A = eye(2); % 状态转移矩阵
   C0 = [2, 3]; % 第一方程系数
   C1 = [3, 2]; % 第二方程系数
   C2 = [1, -1]; % 第三方程系数
   u = 0; % 输入
   xhat0 = [0; 0]; % 初始状态估计
   Gx0 = 1e3 * eye(2); % 初始协方差
   y = [8; 7; 0]; % 测量值
   Gbeta = diag([1, 4, 4]); % 测量噪声协方差矩阵
   C = [C0; C1; C2]; % 联合观测矩阵
   
   % 各步更新结果存储
   steps = {}; % 存储每一步的估计值和协方差
   colors = {'r', 'b', 'g', 'm', 'k'}; % 每次更新不同颜色
   
   % 第一次更新
   [xhat1, Gx1] = kalman(xhat0, Gx0, u, 8, Galpha, 1, A, C0);
   steps{1} = struct('xhat', xhat0, 'Gx', Gx0); % 初始值
   steps{2} = struct('xhat', xhat1, 'Gx', Gx1);
   
   % 第二次更新
   [xhat2, Gx2] = kalman(xhat1, Gx1, u, 7, Galpha, 4, A, C1);
   steps{3} = struct('xhat', xhat2, 'Gx', Gx2);
   
   % 第三次更新
   [xhat3, Gx3] = kalman(xhat2, Gx2, u, 0, Galpha, 4, A, C2);
   steps{4} = struct('xhat', xhat3, 'Gx', Gx3);
   
   % 联合更新
   [xhat_final, Gx_final] = kalman(xhat0, Gx0, u, y, Galpha, Gbeta, A, C);
   steps{5} = struct('xhat', xhat_final, 'Gx', Gx_final);
   
   % GIF 动画参数
   filename = 'multi_ellipse_zoom.gif'; % 输出 GIF 文件名
   num_frames = 50; % 动画帧数
   frame_pause = 0.1; % 每帧间隔时间 (秒)
   
   % 生成动画
   for i = 1:num_frames
       % 缩放范围逐渐变小
       scale = 80 - (75 / (num_frames - 1)) * (i - 1); % 缩放范围从 80 到 5
       clf;
       hold on;
       axis equal;
       grid on;
       
       % 绘制所有置信椭圆
       for j = 1:length(steps)
           draw_ellipse(steps{j}.xhat, steps{j}.Gx, 0.9, colors{j}, 1.5);
       end
       
       % 设置轴范围
       axis([-scale, scale, -scale, scale]);
       title('所有置信椭圆随估计更新逐步缩放');
       xlabel('x'); ylabel('y');
       grid on;
       legend({'初始值', '第1次更新', '第2次更新', '第3次更新', '联合更新'}, 'Location', 'Best');
       drawnow;
       
       % 将当前帧保存到 GIF
       frame = getframe(gcf);
       im = frame2im(frame);
       [imind, cm] = rgb2ind(im, 256);
       if i == 1
           imwrite(imind, cm, filename, 'gif', 'Loopcount', inf, 'DelayTime', frame_pause);
       else
           imwrite(imind, cm, filename, 'gif', 'WriteMode', 'append', 'DelayTime', frame_pause);
       end
   end
   
   disp(['GIF 动画已保存为: ', filename]);
   ```

   

![Dynamic Point Cloud Animation](/img/kalman/multi_ellipse_zoom_adj.gif)

![exo_9_2](/Users/zehua/Documents/GitHub/Zehua716.github.io/static/img/kalman/exo_9_2.png)

![exo_9_3](/Users/zehua/Documents/GitHub/Zehua716.github.io/static/img/kalman/exo_9_3.png)

练习11: 基于到墙壁距离测量的定位

详情见 相关文章
