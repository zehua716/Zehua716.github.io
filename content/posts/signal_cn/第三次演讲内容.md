第三次演讲内容

VAE 的目标是通过最大化  $\log P(X)$  来优化模型。其中的log 是通常对概率取对数，是为了方便计算。因此， $\log P(X)$表示观测数据的对数边际似然。

直接计算  $\log P(X)$ 通常非常复杂，因为积分 $\int P(X, Z) dZ$ 可能没有解析解。
$$
\log P(X) = \log \int P(X, Z) \, dZ
$$
$ P(X, Z)$ ：联合分布，表示数据 X 和隐变量 Z 的联合概率。

因此，VAE 采用变分推断的方法，引入一个可近似的分布 Q(Z|X) 来辅助计算。
$$
\log P(X) = \log \int P(X, Z) \frac{Q(Z)}{Q(Z)} \, dZ
$$

$$
\log P(X) = \log \mathbb{E}_{Q(Z)} \left[ \frac{P(X, Z)}{Q(Z)} \right]
$$

其中
$$
\mathbb{E}_{Q(Z)} \left[ \frac{P(X, Z)}{Q(Z)} \right] = \int \frac{P(X, Z)}{Q(Z)} Q(Z) \, dZ
$$
其中$Q(Z)$是分布	 $ \mathbb{E}{Q(Z)}[\cdot]$  表示对 Q(Z) 的期望。

接下来，我们想利用 Jensen 不等式，将 $\log $穿过积分、穿过期望。

**Jensen 不等式**是概率论和convexe函数理论中的一个重要工具。它的形式如下：

​	•	**定义**：对于一个convexe函数 f(x)，任意随机变量 X，有：
$$
f(\mathbb{E}[X]) \leq \mathbb{E}[f(X)]
$$
​	•	convexe函数 f(x) 的值在平均值点上$ f(\mathbb{E}[X])$，总是小于或等于对所有 X 的 f(X) 的加权平均值$ \mathbb{E}[f(X)]$。



$\log$ **是一个concave函数（对** $(0, \infty) $**范围来说）**，因此，Jensen 不等式应用到 $\log$ 上需要改一下方向，因此有
$$
\log \mathbb{E}[f(Z)] \geq \mathbb{E}[\log f(Z)]
$$

$$
\log P(X) = \log \mathbb{E}_{Q(Z)}\left[\frac{P(X, Z)}{Q(Z)}\right] \geq \mathbb{E}_{Q(Z)}\left[\log \frac{P(X, Z)}{Q(Z)}\right]
$$

采样方面

我们不选择直接从 P(Z) **采样**，而是**从** Q(Z|X) **采样**

因为 P(Z) 是先验分布 是我们假设的一个分布，他可能和 数据 $ x$ 没有过多的关系，这种采样方法，可能效率低

因此我们从辅助分布中采样，由于是由数据$ x$ 引导的分布，因此更加接近于真实后验分布 $  P(Z|X) $，这种采样方法更加高效



最后是 **变分推断（Variational Inference, VI）方面**
$$
\log P(X) = \mathcal{L}(Q) + \mathcal{D}(Q(Z) \| P(Z|X))
$$
\mathcal{L}(Q)：证据下界（Evidence Lower Bound, ELBO）
$$
\mathcal{L}(Q) = \mathbb{E}_{Q(Z)} \left[ \log \frac{P(X, Z)}{Q(Z)} \right]
$$
\mathcal{D}(Q(Z) \| P(Z|X))：KL 散度，用来衡量近似分布 Q(Z) 和真实后验 P(Z|X) 的差异。当 Q(Z) = P(Z|X) 时，KL 散度为零，优化就完美达成。
$$
D_{KL}(Q(Z) \| P(Z|X)) = \mathbb{E}_{Q(Z)} \left[ \log \frac{Q(Z)}{P(Z|X)} \right]
$$
因此，**最大化 ELBO 等价于同时最小化 KL 散度和提升重建能力**。

所以其变分的思想就是，通过最大化 $\mathcal{L}(Q_\phi) $来逼近$ \log P(X)$，并找到能最大化$\mathcal{L}(Q) $的那个$\phi$  即，$\max_\phi \mathcal{L}(Q)$ ，所以现在最大化ELBO

我们重写上述公式
$$
\begin{align*}
\log P(X) &= \mathbb{E}_{Q(Z)} \log P(X) \\
&= \mathbb{E}_{Q(Z)} \log \frac{P(X, Z)}{P(Z \mid X)} \\
&= \mathbb{E}_{Q(Z)} \log \frac{P(X, Z) Q(Z)}{P(Z \mid X) Q(Z)} \\
&= \mathbb{E}_{Q(Z)} \log \frac{P(X, Z)}{Q(Z)} + \mathbb{E}_{Q(Z)} \log \frac{Q(Z)}{P(Z \mid X)} \\
&= \mathbb{E}_{Q(Z)} \log \frac{P(X, Z)}{Q(Z)} + D\big[Q(Z) \| P(Z \mid X)\big]\\

&= \mathcal{L}(Q) + D_{KL}(Q(Z) \| P(Z|X))
\end{align*}
$$

### ELBO=重建误差+正则项







